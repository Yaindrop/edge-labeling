(this.webpackJsonplabeling=this.webpackJsonplabeling||[]).push([[0],{143:function(e,t,n){"use strict";n.r(t);var a,r,c,i,u,o,l,s,f=n(0),h=n.n(f),b=n(17),d=n.n(b),v=(n(87),n(7)),g=n(28),p=n(151),m=n(150),w=(n(88),n(147)),O=n(81),E=n(148),k=n(152),j=n(60),x=[16,800],y=[16,800],C={dist:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},add:function(e,t){return[e[0]+t[0],e[1]+t[1]]},sub:function(e,t){return[e[0]-t[0],e[1]-t[1]]},mul:function(e,t){return[e[0]*t,e[1]*t]},sum:function(e){return e.reduce((function(e,t){return C.add(e,t)}),[0,0])},nbrs:function(e){return[[e[0]-1,e[1]-1],[e[0],e[1]-1],[e[0]+1,e[1]-1],[e[0]+1,e[1]],[e[0]+1,e[1]+1],[e[0],e[1]+1],[e[0]-1,e[1]+1],[e[0]-1,e[1]]]},closeNbrs:function(e){return[[e[0],e[1]-1],[e[0]+1,e[1]],[e[0],e[1]+1],[e[0]-1,e[1]]]}},M=function(e,t){return t[0]>=0&&t[1]>=0&&t[0]<e.cols&&t[1]<e.rows?e.ucharPtr(t[0],t[1])[0]:0},B=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[t,M(e,t)],r=a[0],c=a[1];if(0===c)return r;for(var i=function(t){var a=C.nbrs(r),i=a.map((function(t){return M(e,t)})),u=Math.max.apply(Math,Object(j.a)(i));if(u===c)return"break";var o=i.map((function(e,t){return e===u?t:-1})).filter((function(e){return e>-1}));if(n&&255===u)return"break";i=i.filter((function(e,t){return o.includes(t)})),a=a.filter((function(e,t){return o.includes(t)}));var l=C.sub(C.mul(C.sum(a),1/o.length),r),s=a.map((function(e){return C.dist(e,l)}));return r=a[s.indexOf(Math.min.apply(Math,Object(j.a)(s)))],255===(c=u)?"break":void 0},u=0;u<20;u++){var o=i(u);if("break"===o)break}return r},R=function(e,t){var n=C.nbrs(t).map((function(t){return M(e,t)})).map((function(e){return 255===e?1:0})),a=0;if(n[7]&&n[0]&&n[1]||n[1]&&n[2]&&n[3]||n[3]&&n[4]&&n[5]||n[5]&&n[6]&&n[7])return!0;for(var r=0;r<8;r++)a+=n[r]^n[(r+1)%8];return a>4},W=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(255!==M(e,t))return[];if(R(e,t))return[t];var a=[],r=[],c={};for(r.push(t);r.length;){var i=r.pop();if(!c[i.toString()]){c[i.toString()]=!0,a.push(i);var u=C.nbrs(i).filter((function(t){return 255===M(e,t)})),o=u.filter((function(t){return R(e,t)}));o.length?n&&o.forEach((function(e){return a.push(e)})):u.forEach((function(e){return r.push(e)}))}}return a},S=function(e,t){if(255===M(e,t))return!1;var n=C.nbrs(t).map((function(t){return M(e,t)})).map((function(e){return 255===e?1:0}));if(n.reduce((function(e,t){return e+t}),0)>=7)return!0;for(var a=0,r=0;r<8;r++)a+=n[r]^n[(r+1)%8];return a>=4},N=function(e,t){var n=function(t){return e.filter((function(e){return 255===M(e,t)})).length>0};if(n(t))return[];var a=[],r=[],c={};for(r.push(t);r.length;){var i=r.pop();if(!c[i.toString()])if(c[i.toString()]=!0,a.push(i),C.closeNbrs(i).filter((function(e){return!n(e)})).filter((function(e){return!c[e.toString()]})).forEach((function(e){return r.push(e)})),a.length>1e3)break}return a},V=function(e){return cv.imshow("canvas",e)},A=function(e,t){var n=new cv.Mat.zeros(i.height,i.width,a.type());if(n.copyTo(e),n.delete(),t.showBg&&cv.addWeighted(e,1,u,t.bgWeight,0,e),t.showEdge){var r=new cv.Mat.zeros(i.height,i.width,o.type());t.showEdgeValley?cv.add(o,r,r):cv.threshold(o,r,254,255,cv.THRESH_BINARY),cv.cvtColor(r,r,cv.COLOR_GRAY2RGBA),cv.addWeighted(e,1,r,t.edgeWeight,0,e),r.delete()}if(t.showLabel){var c=new cv.Mat;cv.threshold(l,c,254,255,cv.THRESH_BINARY);var s=new cv.Mat;cv.cvtColor(c,s,cv.COLOR_GRAY2RGBA);var f=new cv.Mat(s.rows,s.cols,s.type(),t.labelColor.map((function(e){return 255-e})));cv.addWeighted(e,1,s,t.labelWeight,0,e),cv.subtract(e,f,e,c),c.delete(),s.delete(),f.delete()}},L=function(){var e=new cv.Mat;cv.threshold(c,e,254,255,cv.THRESH_BINARY),cv.imshow("output",e)},T=function(e){cv.threshold(e,e,254,255,cv.THRESH_BINARY);for(var t=2;t<6;t++){var n=cv.Mat.ones(t,t,cv.CV_8U),a=new cv.Mat;cv.dilate(e,a,n,new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),cv.addWeighted(e,.8,a,.2,0,e),n.delete(),a.delete()}},Y=function(){return i?Object(v.a)({},i):void 0},_=function(e,t){return t<e[0]?e[0]:t>e[1]?e[1]:t},G=function(e){if(function(e){e.width=_(x,e.width),e.height=_(y,e.height),e.x=_([0,a.cols-e.width],e.x),e.y=_([0,a.rows-e.height],e.y)}(e),i){if(e.x===i.x&&e.y===i.y&&e.width===i.width&&e.height===i.height)return void console.log("jerrr");s.delete(),u.delete(),o.delete(),l.delete()}s=new cv.Mat.zeros(e.height,e.width,a.type()),u=a.roi(e),o=r.roi(e),l=c.roi(e),i=e},H={showBg:!0,bgWeight:1,showEdge:!0,showEdgeValley:!1,edgeWeight:.4,showLabel:!0,labelColor:[255,255,0,255],labelWeight:.8},I=new w.a(H),D=new O.a,U=new O.a,z=new O.a,F=new O.a,P=new O.a,q={setVal:function(e,t,n){t[0]>=0&&t[1]>=0&&t[0]<e.cols&&t[1]<e.rows&&e.ucharPtr(t[0],t[1]).set(n)},dimBy:function(e,t){var n=new cv.Mat(e.rows,e.cols,e.type(),[0,0,0,t]);cv.subtract(e,n,e),n.delete()}};I.pipe(Object(E.a)((function(){return s}))).subscribe((function(){A(s,I.value),V(s)})),D.pipe(Object(k.a)(G)).subscribe((function(){T(o),A(s,I.value),V(s)})),U.pipe(Object(k.a)((function(e){a=cv.imread(e),r=new cv.Mat,cv.cvtColor(a,r,cv.COLOR_RGB2GRAY,0),cv.Canny(r,r,50,100,3,!1),c=new cv.Mat.zeros(r.rows,r.cols,r.type()),G({x:0,y:0,width:Math.min(400,e.width),height:Math.min(400,e.height)}),T(o)}))).subscribe((function(){return P.next((function(e,t){return t.dimBy(e,96)}))})),z.pipe(Object(E.a)((function(){return o})),Object(k.a)((function(e){return e(o,q)}))).subscribe((function(){T(o),A(s,I.value),V(s)})),F.pipe(Object(E.a)((function(){return l})),Object(k.a)((function(e){return e(l,q)}))).subscribe((function(){A(s,I.value),V(s)})),P.pipe(Object(E.a)((function(){return s})),Object(k.a)((function(){return A(s,I.value)})),Object(k.a)((function(e){return e(s,q)}))).subscribe((function(){V(s)}));n(89);var J={0:[1,2,3],1:[1,3],2:[2,3],3:[3],4:[3],5:[0],6:[0]},K={0:[0,0,0,0],1:[0,255,255,255],2:[255,0,255,255],3:[255,0,0,255]},Q=[],X=function(e,t){var n=e.getBoundingClientRect();return[(t.clientX-n.left)/n.width,(t.clientY-n.top)/n.height]},Z=function(e,t){var n=t.map((function(t,n){return Math.floor(t*[e.width,e.height][n])}));return[n[1],n[0]]};function $(){var e=Object(f.useState)(!1),t=Object(g.a)(e,2),n=t[0],a=t[1],r=Object(f.useState)(6),c=Object(g.a)(r,2),i=c[0],u=c[1],s=Object(f.useState)(1),b=Object(g.a)(s,2),d=b[0],w=b[1],O=Object(f.useState)(!1),E=Object(g.a)(O,2),k=E[0],j=E[1],C=Object(f.useState)([-1,-1]),R=Object(g.a)(C,2),V=R[0],A=R[1],T=Object(f.useRef)(null),_=Object(f.useRef)(null),G=Object(f.useCallback)((function(){var e,t=document.createElement("a");t.download="label.png",t.href=null===(e=_.current)||void 0===e?void 0:e.toDataURL("image/png"),t.click()}),[]),q=Object(f.useCallback)((function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(d){case 0:t=[];break;case 3:t=[e];break;case 1:t=W(o,B(o,e));break;case 2:t=[B(o,e,!0)].filter((function(e){return M(o,e)}))}if(6===i){if(!k)return;if(-1===V[0])return;var a=Y();D.next(Object(v.a)({},a,{x:a.x+V[1]-e[1],y:a.y+V[0]-e[0]})),Q.push({action:6,targets:[V,e]})}else if(0===i||!k&&!n)P.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,K[d])}))}));else{if(!t.length)return;switch(i){case 1:t=t.filter((function(e){return M(o,e)})),z.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,[0])}))}));break;case 2:z.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,[255])}))}));break;case 3:for(var r=t.pop(),c=20,u=r[0]-c;u<r[0]+c;u++)for(var s=r[1]-c;s<r[1]+c;s++)t.push([u,s]);t=t.filter((function(e){return S(o,e)})),z.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,[255])}))}));break;case 4:t=N([o,l],t[0]),F.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,[255])}))}))}if(!t.length)return;Q.push({action:i,targets:t})}}),[i,d,k,V]),$=Object(f.useCallback)((function(e){switch(e.action){case 1:z.next((function(t,n){return e.targets.forEach((function(e){return n.setVal(t,e,[255])}))}));break;case 2:case 3:z.next((function(t,n){return e.targets.forEach((function(e){return n.setVal(t,e,[0])}))}));break;case 4:F.next((function(t,n){return e.targets.forEach((function(e){return n.setVal(t,e,[0])}))}));break;case 6:var t=Y();D.next(Object(v.a)({},t,{x:t.x+e.targets[1][1]-e.targets[0][1],y:t.y+e.targets[1][0]-e.targets[0][0]}))}}),[]),ee=Object(f.useCallback)((function(e,t){if(d!==e){for(;J[t].indexOf(e)<0;)e=(e+1)%3;w(e)}if(i!==t)switch(u(t),t){case 1:w(1),I.next(Object(v.a)({},H,{showEdgeValley:!0,bgWeight:.5}));break;case 2:w(2),I.next(Object(v.a)({},H,{bgWeight:.8,edgeWeight:.8}));break;case 3:w(3),I.next(Object(v.a)({},H,{bgWeight:.8,edgeWeight:.8}));break;case 4:w(3),I.next(Object(v.a)({},H,{bgWeight:.6}));break;case 5:w(0),I.next(Object(v.a)({},H,{showEdge:!1,labelWeight:.4}));break;case 6:w(0),I.next(H);break;default:w(1),I.next(H)}}),[d,i]),te=Object(f.useCallback)((function(e){U.next(e.currentTarget)}),[]),ne=Object(f.useCallback)((function(e){Y()&&P.next((function(e,t){n||t.dimBy(e,48)}))}),[n]),ae=Object(f.useCallback)((function(e){Y()&&(j(!1),A([-1,-1]),P.next((function(e,t){n||t.dimBy(e,96)})))}),[n]),re=Object(f.useCallback)((function(e){if(Y()&&n){var t=Z(Y(),X(e.currentTarget,e));t.toString()!==V.toString()&&(q(t),A(t))}}),[n,V,q]),ce=Object(f.useCallback)((function(e){if(Y()&&(A([-1,-1]),n&&(j(!0),0!==i))){var t=Z(Y(),X(e.currentTarget,e));q(t,!0)}}),[n,i,q]),ie=Object(f.useCallback)((function(e){Y()&&j(!1)}),[]),ue=Object(f.useCallback)((function(e){if(Y()){A([-1,-1]);var t=d,n=i;switch(e.key){case"f":t=(d+1)%3;break;case"z":Q.length&&$(Q.pop());break;case"s":L(),G();break;case"w":n=1;break;case"e":n=2;break;case"r":n=3;break;case"d":n=4;break;case"v":n=5;break;case"q":n=6;break;default:n=0}ee(t,n)}}),[i,d,$,ee,G]),oe=Object(f.useCallback)((function(){Y()&&(a(!0),P.next((function(){})))}),[]),le=Object(f.useCallback)((function(){Y()&&(a(!1),j(!1),A([-1,-1]),P.next((function(e,t){return t.dimBy(e,96)})))}),[]),se=Object(f.useCallback)((function(e){if(Y()&&6===i){var t=Y();e.preventDefault();var n=X(e.currentTarget,e),a=Z(t,n),r=Object(v.a)({},t,{width:e.deltaY>0?Math.ceil(1.05*t.width):Math.floor(.95*t.width),height:e.deltaY>0?Math.ceil(1.05*t.height):Math.floor(.95*t.height)});if(!(r.width<x[0]||r.width>x[1]||r.height<y[0]||r.height>y[1])){var c=Z(r,n);D.next(Object(v.a)({},r,{x:t.x+a[1]-c[1],y:t.y+a[0]-c[0]}))}}}),[i]);return h.a.createElement("div",{className:"App"},h.a.createElement("div",{className:"input"},h.a.createElement("img",{id:"imageSrc",alt:"Canvas Input",ref:T,onLoad:te,style:{display:"none"}}),h.a.createElement("input",{type:"file",id:"fileInput",name:"file",onChange:function(e){T.current.src=URL.createObjectURL(e.target.files[0])}})),h.a.createElement("div",{className:"radio"},h.a.createElement("span",null,"Action: "),h.a.createElement(p.a.Group,{value:i,onChange:function(e){return ee(d,e.target.value)},disabled:!Y()},h.a.createElement(p.a.Button,{value:0},"No Action"),h.a.createElement(p.a.Button,{value:6},"Move Canvas (Q)"),h.a.createElement(p.a.Button,{value:1},"Wipe Edge (W)"),h.a.createElement(p.a.Button,{value:2},"Draw Edge (E)"),h.a.createElement(p.a.Button,{value:3},"Repair Edge (R)"),h.a.createElement(p.a.Button,{value:4},"Fill Label (D)"),h.a.createElement(p.a.Button,{value:5},"View Label (V)"))),h.a.createElement("div",{className:"radio"},h.a.createElement("span",null,"Cursor (F): "),h.a.createElement(p.a.Group,{value:d,onChange:function(e){return ee(e.target.value,i)},disabled:!Y()},h.a.createElement(p.a.Button,{value:1,disabled:J[i].indexOf(1)<0},"Fall to Edge"),h.a.createElement(p.a.Button,{value:2,disabled:J[i].indexOf(2)<0},"Adhere to Edge"),h.a.createElement(p.a.Button,{value:3,disabled:J[i].indexOf(3)<0},"Floating")),h.a.createElement(m.a,{className:"button",type:"danger",ghost:!0,onClick:function(){Q.length&&$(Q.pop())},disabled:!Y()},"Undo (Z)"),h.a.createElement(m.a,{className:"button",type:"primary",ghost:!0,onClick:function(){L(),G()},disabled:!Y()},"Save Label (S)")),h.a.createElement("div",{className:"canvas"},h.a.createElement("canvas",{id:"canvas",className:6===i?"moving":"",onMouseEnter:ne,onMouseLeave:ae,onMouseMove:re,onMouseDown:ce,onMouseUp:ie,onKeyPress:ue,onFocus:oe,onBlur:le,onWheel:se,tabIndex:1e3})),h.a.createElement("canvas",{id:"output",ref:_}))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));d.a.render(h.a.createElement(h.a.StrictMode,null,h.a.createElement($,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},82:function(e,t,n){e.exports=n(143)},87:function(e,t,n){},89:function(e,t,n){}},[[82,1,2]]]);
//# sourceMappingURL=main.8a3e7f86.chunk.js.map