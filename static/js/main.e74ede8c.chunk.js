(this.webpackJsonplabeling=this.webpackJsonplabeling||[]).push([[0],{106:function(e,t,n){e.exports=n(181)},111:function(e,t,n){},113:function(e,t,n){},181:function(e,t,n){"use strict";n.r(t);var a,r,c,i,u,o,l,s=n(0),h=n.n(s),d=n(7),f=n.n(d),b=(n(111),n(20)),g=n(6),v=n(194),m=n(195),p=n(192),w=n(190),E=n(193),O=n(191),j=(n(112),n(104)),k=n(186),C=n(187),x=n(188),y=n(189),M=n(196),S=n(81),B={dist:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},add:function(e,t){return[e[0]+t[0],e[1]+t[1]]},sub:function(e,t){return[e[0]-t[0],e[1]-t[1]]},mul:function(e,t){return[e[0]*t,e[1]*t]},sum:function(e){return e.reduce((function(e,t){return B.add(e,t)}),[0,0])},nbrs:function(e){return[[e[0]-1,e[1]-1],[e[0],e[1]-1],[e[0]+1,e[1]-1],[e[0]+1,e[1]],[e[0]+1,e[1]+1],[e[0],e[1]+1],[e[0]-1,e[1]+1],[e[0]-1,e[1]]]},closeNbrs:function(e){return[[e[0],e[1]-1],[e[0]+1,e[1]],[e[0],e[1]+1],[e[0]-1,e[1]]]}},W=function(e,t){return t[0]>=0&&t[1]>=0&&t[0]<e.cols&&t[1]<e.rows?e.ucharPtr(t[0],t[1])[0]:0},R=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[t,W(e,t)],r=a[0],c=a[1];if(0===c)return r;for(var i=function(t){var a=B.nbrs(r),i=a.map((function(t){return W(e,t)})),u=Math.max.apply(Math,Object(S.a)(i));if(u===c)return"break";var o=i.map((function(e,t){return e===u?t:-1})).filter((function(e){return e>-1}));if(n&&255===u)return"break";i=i.filter((function(e,t){return o.includes(t)})),a=a.filter((function(e,t){return o.includes(t)}));var l=B.sub(B.mul(B.sum(a),1/o.length),r),s=a.map((function(e){return B.dist(e,l)}));return r=a[s.indexOf(Math.min.apply(Math,Object(S.a)(s)))],255===(c=u)?"break":void 0},u=0;u<20;u++){var o=i(u);if("break"===o)break}return r},L=function(e,t){var n=B.nbrs(t).map((function(t){return W(e,t)})).map((function(e){return 255===e?1:0})),a=0;if(n[7]&&n[0]&&n[1]||n[1]&&n[2]&&n[3]||n[3]&&n[4]&&n[5]||n[5]&&n[6]&&n[7])return!0;for(var r=0;r<8;r++)a+=n[r]^n[(r+1)%8];return a>4},N=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(255!==W(e,t))return[];if(L(e,t))return[t];var a=[],r=[],c={};for(r.push(t);r.length;){var i=r.pop();if(!c[i.toString()]){c[i.toString()]=!0,a.push(i);var u=B.nbrs(i).filter((function(t){return 255===W(e,t)})),o=u.filter((function(t){return L(e,t)}));o.length?n&&o.forEach((function(e){return a.push(e)})):u.forEach((function(e){return r.push(e)}))}}return a},A=function(e,t){if(255===W(e,t))return!1;var n=B.nbrs(t).map((function(t){return W(e,t)})).map((function(e){return 255===e?1:0}));if(n.reduce((function(e,t){return e+t}),0)>=7)return!0;for(var a=0,r=0;r<8;r++)a+=n[r]^n[(r+1)%8];return a>=4},T=function(e,t){var n=function(t){return e.filter((function(e){return 255===W(e,t)})).length>0};if(n(t))return[];var a=[],r=[],c={};for(r.push(t);r.length;){var i=r.pop();if(!c[i.toString()])if(c[i.toString()]=!0,a.push(i),B.closeNbrs(i).filter((function(e){return!n(e)})).filter((function(e){return!c[e.toString()]})).forEach((function(e){return r.push(e)})),a.length>1e3)break}return a},U=function(e,t,n){t[0]>=0&&t[1]>=0&&t[0]<e.cols&&t[1]<e.rows&&e.ucharPtr(t[0],t[1]).set(n)},V=function(e){cv.threshold(e,e,254,255,cv.THRESH_BINARY);for(var t=2;t<6;t++){var n=cv.Mat.ones(t,t,cv.CV_8U),a=new cv.Mat;cv.dilate(e,a,n,new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),cv.addWeighted(e,.8,a,.2,0,e),n.delete(),a.delete()}},Y=[],_={width:[16,800],height:[16,800]},D={showBg:!0,bgWeight:1,showEdge:!0,showEdgeValley:!1,edgeWeight:.4,showLabel:!0,labelColor:[255,255,0,255],labelWeight:.8},G=new j.a,H=new k.a(D),I=new j.a,z=new k.a(null),F=new j.a,q=new j.a,J=new j.a,P=new j.a,K=function(){var e=Y.pop();e&&(I.next(e.roi),e.update.next(Object(g.a)({},e,{isUndo:!0})))},Q=function(e,t){return t<e[0]?e[0]:t>e[1]?e[1]:t};G.pipe(Object(C.a)((function(){return z.value}))).subscribe((function(e){return H.next(e)})),H.subscribe((function(){return P.next({})})),I.pipe(Object(x.a)((function(e){return{width:Q(_.width,e.width),height:Q(_.height,e.height),x:Q([0,_.width[1]-e.width-1],e.x),y:Q([0,_.height[1]-e.height-1],e.y)}})),Object(y.a)((function(e,t){return JSON.stringify(e)===JSON.stringify(t)})),Object(M.a)(console.log),Object(M.a)((function(e){l&&(l.delete(),i.delete(),u.delete(),o.delete()),l=new cv.Mat.zeros(e.height,e.width,a.type()),i=a.roi(e),u=r.roi(e),o=c.roi(e)}))).subscribe((function(e){return z.next(e)})),z.subscribe((function(){return q.next({})})),F.pipe(Object(M.a)((function(e){a=cv.imread(e),r=new cv.Mat,cv.cvtColor(a,r,cv.COLOR_RGB2GRAY,0),cv.Canny(r,r,50,100,3,!1),c=new cv.Mat.zeros(r.rows,r.cols,r.type())}))).subscribe((function(e){_={width:[16,Math.min(_.width[1],e.width)],height:[16,Math.min(_.height[1],e.height)]},I.next({x:0,y:0,width:Math.min(400,e.width),height:Math.min(400,e.height)}),V(u),P.next({dimBy:96})})),q.pipe(Object(C.a)((function(){return z.value}))).subscribe((function(e){var t;(null===(t=e.targets)||void 0===t?void 0:t.length)&&(e.targets.forEach((function(t){return U(u,t,[e.isSet?255:0])})),e.isUndo||Y.push({update:q,roi:z.value,targets:e.targets,isSet:!e.isSet})),V(u),P.next({})})),J.pipe(Object(C.a)((function(){return z.value}))).subscribe((function(e){var t;(null===(t=e.targets)||void 0===t?void 0:t.length)&&(e.targets.forEach((function(t){return U(o,t,[e.isSet?255:0])})),e.isUndo||Y.push({update:J,roi:z.value,targets:e.targets,isSet:!e.isSet})),function(){var e=new cv.Mat;cv.threshold(c,e,254,255,cv.THRESH_BINARY),cv.imshow("output",e)}(),P.next({})})),P.pipe(Object(C.a)((function(){return z.value})),Object(M.a)((function(){return function(e,t){var n=new cv.Mat.zeros(i.rows,i.cols,a.type());if(n.copyTo(e),n.delete(),t.showBg&&cv.addWeighted(e,1,i,t.bgWeight,0,e),t.showEdge){var r=new cv.Mat.zeros(u.rows,u.cols,u.type());t.showEdgeValley?cv.add(u,r,r):cv.threshold(u,r,254,255,cv.THRESH_BINARY),cv.cvtColor(r,r,cv.COLOR_GRAY2RGBA),cv.addWeighted(e,1,r,t.edgeWeight,0,e),r.delete()}if(t.showLabel){var c=new cv.Mat;cv.threshold(o,c,254,255,cv.THRESH_BINARY);var l=new cv.Mat;cv.cvtColor(c,l,cv.COLOR_GRAY2RGBA);var s=new cv.Mat(l.rows,l.cols,l.type(),t.labelColor.map((function(e){return 255-e})));cv.addWeighted(e,1,l,t.labelWeight,0,e),cv.subtract(e,s,e,c),c.delete(),l.delete(),s.delete()}}(l,H.value)}))).subscribe((function(e){var t,n;(null===(t=e.targets)||void 0===t?void 0:t.length)&&e.targets.forEach((function(t){return U(l,t,e.color)})),e.dimBy&&function(e,t){var n=new cv.Mat(e.rows,e.cols,e.type(),[0,0,0,t]);cv.subtract(e,n,e),n.delete()}(l,e.dimBy),n=l,cv.imshow("canvas",n)}));n(113);var X={0:[1,2,3],1:[1,3],2:[2,3],3:[3],4:[3]},Z={0:D,1:Object(g.a)({},D,{showEdgeValley:!0,bgWeight:.5}),2:Object(g.a)({},D,{bgWeight:.8,edgeWeight:.8}),3:Object(g.a)({},D,{bgWeight:.8,edgeWeight:.8}),4:Object(g.a)({},D,{bgWeight:.6}),5:Object(g.a)({},D,{showEdge:!1,labelWeight:.4})},$={0:[0,0,0,0],1:[0,255,255,255],2:[255,0,255,255],3:[255,0,0,255]},ee=function(e,t){var n=e.getBoundingClientRect();return[(t.clientX-n.left)/n.width,(t.clientY-n.top)/n.height]},te=function(e,t){var n=t.map((function(t,n){return Math.floor(t*[e.width,e.height][n])}));return[n[1],n[0]]};function ne(){var e=Object(s.useState)(!1),t=Object(b.a)(e,2),n=t[0],a=t[1],r=Object(s.useState)(0),c=Object(b.a)(r,2),i=c[0],l=c[1],d=Object(s.useState)(1),f=Object(b.a)(d,2),j=f[0],k=f[1],C=Object(s.useState)(!1),x=Object(b.a)(C,2),y=x[0],M=x[1],S=Object(s.useState)([-1,-1]),B=Object(b.a)(S,2),L=B[0],U=B[1],V=Object(s.useState)(!1),Y=Object(b.a)(V,2),D=Y[0],Q=Y[1],ne=Object(s.useState)(z.value),ae=Object(b.a)(ne,2),re=ae[0],ce=ae[1],ie=Object(s.useState)(H.value),ue=Object(b.a)(ie,2),oe=ue[0],le=ue[1],se=Object(s.useRef)(null),he=Object(s.useRef)(null),de=re&&!0;Object(s.useEffect)((function(){var e=z.subscribe(ce),t=H.subscribe(le);return function(){e.unsubscribe(),t.unsubscribe()}}),[]);var fe=Object(s.useCallback)((function(){var e,t=document.createElement("a");t.download="label.png",t.href=null===(e=he.current)||void 0===e?void 0:e.toDataURL("image/png"),t.click()}),[]),be=Object(s.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(D){if(!y||-1===L[0])return;console.log(re),I.next(Object(g.a)({},re,{x:re.x+L[1]-e[1],y:re.y+L[0]-e[0]}))}else{var n;switch(j){case 0:n=[];break;case 3:n=[e];break;case 1:n=N(u,R(u,e));break;case 2:n=[R(u,e,!0)].filter((function(e){return W(u,e)}))}if(0===i||!y&&!t)P.next({targets:n,color:$[j]});else{if(!n.length)return;switch(i){case 1:n=n.filter((function(e){return 255===W(u,e)})),q.next({isSet:!1,targets:n});break;case 2:q.next({isSet:!0,targets:n});break;case 3:for(var a=n.pop(),r=20,c=a[0]-r;c<a[0]+r;c++)for(var l=a[1]-r;l<a[1]+r;l++)n.push([c,l]);n=n.filter((function(e){return A(u,e)})),q.next({isSet:!0,targets:n});break;case 4:n=T([u,o],n[0]),J.next({isSet:!0,targets:n})}if(!n.length)return}}}),[re,i,j,y,L,D]),ge=Object(s.useCallback)((function(e,t){if(j!==e){for(;X[t].indexOf(e)<0;)e=(e+1)%4;k(e)}i!==t&&(l(t),k(X[t][0]),G.next(Z[t]))}),[j,i]),ve=Object(s.useCallback)((function(e){F.next(e.currentTarget)}),[]),me=Object(s.useCallback)((function(e){de&&(n||P.next({dimBy:64}))}),[de,n]),pe=Object(s.useCallback)((function(e){de&&(M(!1),U([-1,-1]),n||P.next({dimBy:96}))}),[de,n]),we=Object(s.useCallback)((function(e){if(de&&n){var t=te(re,ee(e.currentTarget,e));t.toString()!==L.toString()&&(be(t),U(t))}}),[de,re,n,L,be]),Ee=Object(s.useCallback)((function(e){if(de&&(U([-1,-1]),n&&(M(!0),0!==i))){var t=te(re,ee(e.currentTarget,e));be(t,!0)}}),[de,re,n,i,be]),Oe=Object(s.useCallback)((function(e){de&&M(!1)}),[de]),je=Object(s.useCallback)((function(e){if(de&&!D){U([-1,-1]);var t=j,n=i;switch(e.key){case"q":break;case"f":t=(j+1)%4;break;case"z":K();break;case"s":fe();break;case"w":n=1;break;case"e":n=2;break;case"r":n=3;break;case"d":n=4;break;default:n=0}ge(t,n)}}),[de,D,i,j,ge,fe]),ke=Object(s.useCallback)((function(e){if(de)switch(e.key){case"q":Q(!0)}}),[de]),Ce=Object(s.useCallback)((function(e){if(de)switch(e.key){case"q":Q(!1)}}),[de]),xe=Object(s.useCallback)((function(){de&&(a(!0),P.next({}))}),[de]),ye=Object(s.useCallback)((function(){de&&(a(!1),M(!1),U([-1,-1]),P.next({dimBy:96}))}),[de]),Me=Object(s.useCallback)((function(e){if(de&&D){e.preventDefault();var t=ee(e.currentTarget,e),n=te(re,t),a=Object(g.a)({},re,{width:e.deltaY>0?Math.ceil(1.05*re.width):Math.floor(.95*re.width),height:e.deltaY>0?Math.ceil(1.05*re.height):Math.floor(.95*re.height)});if(!(a.width<_.width[0]||a.width>_.width[1]||a.height<_.height[0]||a.height>_.height[1])){var r=te(a,t);I.next(Object(g.a)({},a,{x:re.x+n[1]-r[1],y:re.y+n[0]-r[0]}))}}}),[de,re,D]),Se=Object(s.useMemo)((function(){return h.a.createElement(v.a,{align:"middle"},h.a.createElement(m.a,{span:24},h.a.createElement("span",null,"Action: "),h.a.createElement(p.a.Group,{value:i,onChange:function(e){return ge(j,e.target.value)},disabled:!de},h.a.createElement(p.a.Button,{value:0},"No Action"),h.a.createElement(p.a.Button,{value:1},"Wipe Edge (W)"),h.a.createElement(p.a.Button,{value:2},"Draw Edge (E)"),h.a.createElement(p.a.Button,{value:3},"Repair Edge (R)"),h.a.createElement(p.a.Button,{value:4},"Fill Label (D)"))))}),[de,i,j,ge]),Be=Object(s.useMemo)((function(){return h.a.createElement(v.a,{align:"middle"},h.a.createElement(m.a,{span:4},h.a.createElement("span",null,"Move Canvas: "),h.a.createElement(w.a,{checked:D,unCheckedChildren:"Q",checkedChildren:"Q"})),h.a.createElement(m.a,{span:10},h.a.createElement("span",null,"Cursor (F): "),h.a.createElement(p.a.Group,{value:j,onChange:function(e){return ge(e.target.value,i)},disabled:!de},h.a.createElement(p.a.Button,{value:1,disabled:X[i].indexOf(1)<0},"Fall to Edge"),h.a.createElement(p.a.Button,{value:2,disabled:X[i].indexOf(2)<0},"Adhere to Edge"),h.a.createElement(p.a.Button,{value:3,disabled:X[i].indexOf(3)<0},"Floating"))),h.a.createElement(m.a,{span:3},h.a.createElement(E.a,{className:"button",type:"danger",ghost:!0,onClick:K,disabled:!de},"Undo (Z)")),h.a.createElement(m.a,{span:3},h.a.createElement(E.a,{className:"button",type:"primary",ghost:!0,onClick:fe,disabled:!de},"Save Label (S)")))}),[de,i,j,fe,D,ge]),We=Object(s.useMemo)((function(){return h.a.createElement(v.a,{align:"middle"},h.a.createElement(m.a,{span:2,offset:4},h.a.createElement("span",null,"Appearance: ")),h.a.createElement(m.a,{span:3},h.a.createElement(w.a,{disabled:!de,checked:oe.showBg,unCheckedChildren:"Background",checkedChildren:"Background",onClick:function(){return G.next(Object(g.a)({},oe,{showBg:!oe.showBg}))}}),h.a.createElement(O.a,{disabled:!de,min:0,max:1,step:.1,value:oe.bgWeight,onChange:function(e){return G.next(Object(g.a)({},oe,{bgWeight:e}))}})),h.a.createElement(m.a,{span:3,offset:1},h.a.createElement(v.a,null,h.a.createElement(m.a,{span:12},h.a.createElement(w.a,{disabled:!de,checked:oe.showEdge,unCheckedChildren:"Edge",checkedChildren:"Edge",onClick:function(){return G.next(Object(g.a)({},oe,{showEdge:!oe.showEdge}))}})),h.a.createElement(m.a,{span:12},h.a.createElement(w.a,{disabled:!de,checked:oe.showEdgeValley&&oe.showEdge,unCheckedChildren:"Valley",checkedChildren:"Valley",onClick:function(){return G.next(Object(g.a)({},oe,{showEdgeValley:!oe.showEdgeValley}))}}))),h.a.createElement(O.a,{disabled:!de,min:0,max:1,step:.1,value:oe.edgeWeight,onChange:function(e){return G.next(Object(g.a)({},oe,{edgeWeight:e}))}})),h.a.createElement(m.a,{span:3,offset:1},h.a.createElement(w.a,{disabled:!de,checked:oe.showLabel,unCheckedChildren:"Label",checkedChildren:"Label",onClick:function(){return G.next(Object(g.a)({},oe,{showLabel:!oe.showLabel}))}}),h.a.createElement(O.a,{disabled:!de,min:0,max:1,step:.1,value:oe.labelWeight,onChange:function(e){return G.next(Object(g.a)({},oe,{labelWeight:e}))}})))}),[de,oe]);return h.a.createElement("div",{className:"App"},h.a.createElement("div",{className:"input"},h.a.createElement("img",{id:"imageSrc",alt:"Canvas Input",ref:se,onLoad:ve,style:{display:"none"}}),h.a.createElement("input",{type:"file",id:"fileInput",name:"file",onChange:function(e){se.current.src=URL.createObjectURL(e.target.files[0])}})),Se,Be,We,h.a.createElement("div",{className:"canvas"},h.a.createElement("canvas",{id:"canvas",className:D?"moving":"",onMouseEnter:me,onMouseLeave:pe,onMouseMove:we,onMouseDown:Ee,onMouseUp:Oe,onKeyPress:je,onFocus:xe,onBlur:ye,onWheel:Me,onKeyDown:ke,onKeyUp:Ce,tabIndex:1e3})),h.a.createElement("canvas",{id:"output",ref:he}))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));f.a.render(h.a.createElement(h.a.StrictMode,null,h.a.createElement(ne,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[106,1,2]]]);
//# sourceMappingURL=main.e74ede8c.chunk.js.map