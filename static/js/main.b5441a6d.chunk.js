(this.webpackJsonplabeling=this.webpackJsonplabeling||[]).push([[0],{143:function(e,t,n){"use strict";n.r(t);var r,a,c,u,i,o,l,s,f=n(0),h=n.n(f),b=n(17),d=n.n(b),v=(n(87),n(7)),g=n(28),p=n(151),w=n(150),m=(n(88),n(147)),O=n(81),E=n(148),k=n(152),j=n(60),x={dist:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},add:function(e,t){return[e[0]+t[0],e[1]+t[1]]},sub:function(e,t){return[e[0]-t[0],e[1]-t[1]]},mul:function(e,t){return[e[0]*t,e[1]*t]},sum:function(e){return e.reduce((function(e,t){return x.add(e,t)}),[0,0])},nbrs:function(e){return[[e[0]-1,e[1]-1],[e[0],e[1]-1],[e[0]+1,e[1]-1],[e[0]+1,e[1]],[e[0]+1,e[1]+1],[e[0],e[1]+1],[e[0]-1,e[1]+1],[e[0]-1,e[1]]]},closeNbrs:function(e){return[[e[0],e[1]-1],[e[0]+1,e[1]],[e[0],e[1]+1],[e[0]-1,e[1]]]}},y=function(e,t){return t[0]>=0&&t[1]>=0&&t[0]<e.cols&&t[1]<e.rows?e.ucharPtr(t[0],t[1])[0]:0},C=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[t,y(e,t)],a=r[0],c=r[1];if(0===c)return a;for(var u=function(t){var r=x.nbrs(a),u=r.map((function(t){return y(e,t)})),i=Math.max.apply(Math,Object(j.a)(u));if(i===c)return"break";var o=u.map((function(e,t){return e===i?t:-1})).filter((function(e){return e>-1}));if(n&&255===i)return"break";u=u.filter((function(e,t){return o.includes(t)})),r=r.filter((function(e,t){return o.includes(t)}));var l=x.sub(x.mul(x.sum(r),1/o.length),a),s=r.map((function(e){return x.dist(e,l)}));return a=r[s.indexOf(Math.min.apply(Math,Object(j.a)(s)))],255===(c=i)?"break":void 0},i=0;i<20;i++){var o=u(i);if("break"===o)break}return a},B=function(e,t){var n=x.nbrs(t).map((function(t){return y(e,t)})).map((function(e){return 255===e?1:0})),r=0;if(n[7]&&n[0]&&n[1]||n[1]&&n[2]&&n[3]||n[3]&&n[4]&&n[5]||n[5]&&n[6]&&n[7])return!0;for(var a=0;a<8;a++)r+=n[a]^n[(a+1)%8];return r>4},M=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(255!==y(e,t))return[];if(B(e,t))return[t];var r=[],a=[],c={};for(a.push(t);a.length;){var u=a.pop();if(!c[u.toString()]){c[u.toString()]=!0,r.push(u);var i=x.nbrs(u).filter((function(t){return 255===y(e,t)})),o=i.filter((function(t){return B(e,t)}));o.length?n&&o.forEach((function(e){return r.push(e)})):i.forEach((function(e){return a.push(e)}))}}return r},R=function(e,t){if(255===y(e,t))return!1;var n=x.nbrs(t).map((function(t){return y(e,t)})).map((function(e){return 255===e?1:0}));if(n.reduce((function(e,t){return e+t}),0)>=7)return!0;for(var r=0,a=0;a<8;a++)r+=n[a]^n[(a+1)%8];return r>=4},W=function(e,t){var n=function(t){return e.filter((function(e){return 255===y(e,t)})).length>0};if(n(t))return[];var r=[],a=[],c={};for(a.push(t);a.length;){var u=a.pop();if(!c[u.toString()])if(c[u.toString()]=!0,r.push(u),x.closeNbrs(u).filter((function(e){return!n(e)})).filter((function(e){return!c[e.toString()]})).forEach((function(e){return a.push(e)})),r.length>1e3)break}return r},S=function(e){return cv.imshow("canvas",e)},N=function(e,t){if(new cv.Mat.zeros(u.height,u.width,r.type()).copyTo(e),t.showBg&&cv.addWeighted(e,1,i,t.bgWeight,0,e),t.showEdge){var n=new cv.Mat.zeros(u.height,u.width,o.type());t.showEdgeValley?cv.add(o,n,n):cv.threshold(o,n,254,255,cv.THRESH_BINARY),cv.cvtColor(n,n,cv.COLOR_GRAY2RGBA),cv.addWeighted(e,1,n,t.edgeWeight,0,e),n.delete()}if(t.showLabel){var a=new cv.Mat;cv.threshold(l,a,254,255,cv.THRESH_BINARY);var c=new cv.Mat;cv.cvtColor(a,c,cv.COLOR_GRAY2RGBA);var s=new cv.Mat(c.rows,c.cols,c.type(),t.labelColor.map((function(e){return 255-e})));cv.addWeighted(e,1,c,t.labelWeight,0,e),cv.subtract(e,s,e,a),a.delete(),c.delete(),s.delete()}},V=function(e){cv.threshold(e,e,254,255,cv.THRESH_BINARY);for(var t=2;t<6;t++){var n=cv.Mat.ones(t,t,cv.CV_8U),r=new cv.Mat;cv.dilate(e,r,n,new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),cv.addWeighted(e,.8,r,.2,0,e),n.delete(),r.delete()}},A=function(){return u?Object(v.a)({},u):void 0},L=function(e){if(e.width<16||e.height<16){if(16===u.width||16===u.height)return;e.width=e.height=16}if(e.width>1024||e.height>1024){if(1024===u.width||1024===u.height)return;e.width=e.height=1024}e.x>=0&&e.y>=0&&e.x+e.width<r.cols&&e.y+e.height<r.rows&&(u&&(s.delete(),i.delete(),o.delete(),l.delete()),s=new cv.Mat.zeros(e.height,e.width,r.type()),i=r.roi(e),o=a.roi(e),l=c.roi(e),u=e)},T={showBg:!0,bgWeight:1,showEdge:!0,showEdgeValley:!1,edgeWeight:.4,showLabel:!0,labelColor:[255,255,0,255],labelWeight:.8},Y=new m.a(T),G=new O.a,_=new O.a,I=new O.a,D=new O.a,H=new O.a,z={setVal:function(e,t,n){t[0]>=0&&t[1]>=0&&t[0]<e.cols&&t[1]<e.rows&&e.ucharPtr(t[0],t[1]).set(n)},dimBy:function(e,t){var n=new cv.Mat(e.rows,e.cols,e.type(),[0,0,0,t]);cv.subtract(e,n,e),n.delete()}};Y.pipe(Object(E.a)((function(){return s}))).subscribe((function(){N(s,Y.value),S(s)})),G.pipe(Object(k.a)(L)).subscribe((function(){V(o),N(s,Y.value),S(s)})),_.pipe(Object(k.a)((function(e){r=cv.imread(e),a=new cv.Mat,cv.cvtColor(r,a,cv.COLOR_RGB2GRAY,0),cv.Canny(a,a,50,100,3,!1),c=new cv.Mat.zeros(a.rows,a.cols,a.type()),L({x:550,y:450,width:500,height:500}),V(o)}))).subscribe((function(){return H.next((function(e,t){return t.dimBy(e,96)}))})),I.pipe(Object(E.a)((function(){return o})),Object(k.a)((function(e){return e(o,z)}))).subscribe((function(){V(o),N(s,Y.value),S(s)})),D.pipe(Object(E.a)((function(){return l})),Object(k.a)((function(e){return e(l,z)}))).subscribe((function(){N(s,Y.value),S(s)})),H.pipe(Object(E.a)((function(){return s})),Object(k.a)((function(){return N(s,Y.value)})),Object(k.a)((function(e){return e(s,z)}))).subscribe((function(){S(s)}));n(89);var F={0:[1,2,3],1:[1,3],2:[2,3],3:[3],4:[3],5:[0],6:[0]},U={0:[0,0,0,0],1:[0,255,255,255],2:[255,0,255,255],3:[255,0,0,255]},P=[],J=function(e,t){var n=e.getBoundingClientRect();return[(t.clientX-n.left)/n.width,(t.clientY-n.top)/n.height]},q=function(e,t){var n=t.map((function(t,n){return Math.floor(t*[e.width,e.height][n])}));return[n[1],n[0]]};function K(){var e=Object(f.useState)(!1),t=Object(g.a)(e,2),n=t[0],r=t[1],a=Object(f.useState)(0),c=Object(g.a)(a,2),u=c[0],i=c[1],s=Object(f.useState)(1),b=Object(g.a)(s,2),d=b[0],m=b[1],O=Object(f.useState)(!1),E=Object(g.a)(O,2),k=E[0],j=E[1],x=Object(f.useState)([-1,-1]),B=Object(g.a)(x,2),S=B[0],N=B[1],V=Object(f.useRef)(null),L=Object(f.useCallback)((function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(d){case 0:t=[];break;case 3:t=[e];break;case 1:t=M(o,C(o,e));break;case 2:t=[C(o,e,!0)].filter((function(e){return y(o,e)}))}if(6===u){if(!k)return;var r=A();G.next(Object(v.a)({},r,{x:r.x+S[1]-e[1],y:r.y+S[0]-e[0]})),P.push({action:6,targets:[S,e]})}else if(0===u||!k&&!n)H.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,U[d])}))}));else{if(!t.length)return;switch(u){case 1:t=t.filter((function(e){return y(o,e)})),I.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,[0])}))}));break;case 2:I.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,[255])}))}));break;case 3:for(var a=t.pop(),c=20,i=a[0]-c;i<a[0]+c;i++)for(var s=a[1]-c;s<a[1]+c;s++)t.push([i,s]);t=t.filter((function(e){return R(o,e)})),I.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,[255])}))}));break;case 4:t=W([o,l],t[0]),D.next((function(e,n){return t.forEach((function(t){return n.setVal(e,t,[255])}))}))}if(!t.length)return;P.push({action:u,targets:t})}}),[u,d,k,S]),z=Object(f.useCallback)((function(e){switch(e.action){case 1:I.next((function(t,n){return e.targets.forEach((function(e){return n.setVal(t,e,[255])}))}));break;case 2:case 3:I.next((function(t,n){return e.targets.forEach((function(e){return n.setVal(t,e,[0])}))}));break;case 4:D.next((function(t,n){return e.targets.forEach((function(e){return n.setVal(t,e,[0])}))}));break;case 6:var t=A();G.next(Object(v.a)({},t,{x:t.x+e.targets[1][1]-e.targets[0][1],y:t.y+e.targets[1][0]-e.targets[0][0]}))}}),[]),K=Object(f.useCallback)((function(e){_.next(e.currentTarget)}),[]),X=Object(f.useCallback)((function(e){H.next((function(e,t){n||t.dimBy(e,48)}))}),[n]),Z=Object(f.useCallback)((function(e){H.next((function(e,t){n||t.dimBy(e,96)}))}),[n]),$=Object(f.useCallback)((function(e){if(n&&A()){var t=q(A(),J(e.currentTarget,e));t.toString()!==S.toString()&&(L(t),N(t))}}),[n,S,L]),Q=Object(f.useCallback)((function(e){if(N([-1,-1]),n&&(j(!0),0!==u&&A())){var t=q(A(),J(e.currentTarget,e));L(t,!0)}}),[n,u,L]),ee=Object(f.useCallback)((function(e){j(!1)}),[]),te=Object(f.useCallback)((function(e,t){if(d!==e){for(;F[t].indexOf(e)<0;)e=(e+1)%3;m(e)}if(u!==t)switch(i(t),t){case 1:m(1),Y.next(Object(v.a)({},T,{showEdgeValley:!0,bgWeight:.5}));break;case 2:m(2),Y.next(Object(v.a)({},T,{bgWeight:.8,edgeWeight:.8}));break;case 3:m(3),Y.next(Object(v.a)({},T,{bgWeight:.8,edgeWeight:.8}));break;case 4:m(3),Y.next(Object(v.a)({},T,{bgWeight:.6}));break;case 5:m(0),Y.next(Object(v.a)({},T,{showBg:!1,showEdge:!1,labelWeight:1}));break;case 6:m(0),Y.next(T);break;default:m(1),Y.next(T)}}),[d,u]),ne=Object(f.useCallback)((function(e){N([-1,-1]);var t=d,n=u;switch(e.key){case"f":t=(d+1)%3;break;case"z":P.length&&z(P.pop());break;case"w":n=1;break;case"e":n=2;break;case"r":n=3;break;case"d":n=4;break;case"s":n=5;break;case"m":n=6;break;default:n=0}te(t,n)}),[u,d,z,te]),re=Object(f.useCallback)((function(){r(!0)}),[]),ae=Object(f.useCallback)((function(){r(!1),H.next((function(e,t){return t.dimBy(e,96)}))}),[]),ce=Object(f.useCallback)((function(e){if(6===u){e.preventDefault();var t=J(e.currentTarget,e),n=A(),r=q(n,t);console.log(r);var a=Object(v.a)({},n,{width:n.width-e.deltaY,height:n.height-e.deltaY}),c=q(a,t);console.log(c),G.next(Object(v.a)({},a,{x:n.x+r[1]-c[1],y:n.y+r[0]-c[0]}))}}),[u]);return h.a.createElement("div",{className:"App"},h.a.createElement("div",{className:"input"},h.a.createElement("img",{id:"imageSrc",alt:"Canvas Input",ref:V,onLoad:K,style:{display:"none"}}),h.a.createElement("input",{type:"file",id:"fileInput",name:"file",onChange:function(e){V.current.src=URL.createObjectURL(e.target.files[0])}})),h.a.createElement("div",{className:"radio"},h.a.createElement("span",null,"Action: "),h.a.createElement(p.a.Group,{value:u,onChange:function(e){return te(d,e.target.value)},disabled:!A()},h.a.createElement(p.a.Button,{value:0},"No Action"),h.a.createElement(p.a.Button,{value:1},"Wipe Edge (W)"),h.a.createElement(p.a.Button,{value:2},"Draw Edge (E)"),h.a.createElement(p.a.Button,{value:3},"Repair Edge (R)"),h.a.createElement(p.a.Button,{value:4},"Fill Label (D)"),h.a.createElement(p.a.Button,{value:5},"Save Label (S)"),h.a.createElement(p.a.Button,{value:6},"Move Canvas (M)"))),h.a.createElement("div",{className:"radio"},h.a.createElement("span",null,"Cursor (F): "),h.a.createElement(p.a.Group,{value:d,onChange:function(e){return te(e.target.value,u)},disabled:!A()},h.a.createElement(p.a.Button,{value:1,disabled:F[u].indexOf(1)<0},"Fall to Edge"),h.a.createElement(p.a.Button,{value:2,disabled:F[u].indexOf(2)<0},"Adhere to Edge"),h.a.createElement(p.a.Button,{value:3,disabled:F[u].indexOf(3)<0},"Floating")),h.a.createElement(w.a,{className:"undo",type:"danger",ghost:!0,onClick:function(){P.length&&z(P.pop())},disabled:!A()},"Undo (Z)")),h.a.createElement("div",{className:"canvas"},h.a.createElement("canvas",{id:"canvas",className:6===u?"moving":"",onMouseEnter:X,onMouseLeave:Z,onMouseMove:$,onMouseDown:Q,onMouseUp:ee,onKeyPress:ne,onFocus:re,onBlur:ae,onWheel:ce,tabIndex:1e3})))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));d.a.render(h.a.createElement(h.a.StrictMode,null,h.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},82:function(e,t,n){e.exports=n(143)},87:function(e,t,n){},89:function(e,t,n){}},[[82,1,2]]]);
//# sourceMappingURL=main.b5441a6d.chunk.js.map