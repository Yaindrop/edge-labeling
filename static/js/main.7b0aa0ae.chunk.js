(this.webpackJsonplabeling=this.webpackJsonplabeling||[]).push([[0],{107:function(e,t,n){e.exports=n(182)},112:function(e,t,n){},114:function(e,t,n){},182:function(e,t,n){"use strict";n.r(t);var a,r,c,i,u,o,l,s,h=n(0),d=n.n(h),f=n(6),b=n.n(f),g=(n(112),n(19)),v=n(13),m=n(195),p=n(196),w=n(193),E=n(191),O=n(194),k=n(192),j=(n(113),n(105)),C=n(187),x=n(188),y=n(98),M=n(189),S=n(190),B=n(197),R=n(81),W={dist:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},add:function(e,t){return[e[0]+t[0],e[1]+t[1]]},sub:function(e,t){return[e[0]-t[0],e[1]-t[1]]},mul:function(e,t){return[e[0]*t,e[1]*t]},sum:function(e){return e.reduce((function(e,t){return W.add(e,t)}),[0,0])},nbrs:function(e){return[[e[0]-1,e[1]-1],[e[0],e[1]-1],[e[0]+1,e[1]-1],[e[0]+1,e[1]],[e[0]+1,e[1]+1],[e[0],e[1]+1],[e[0]-1,e[1]+1],[e[0]-1,e[1]]]},closeNbrs:function(e){return[[e[0],e[1]-1],[e[0]+1,e[1]],[e[0],e[1]+1],[e[0]-1,e[1]]]}},L=function(e,t){return t[0]>=0&&t[1]>=0&&t[0]<e.cols&&t[1]<e.rows?e.ucharPtr(t[0],t[1])[0]:0},N=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[t,L(e,t)],r=a[0],c=a[1];if(0===c)return r;for(var i=function(t){var a=W.nbrs(r),i=a.map((function(t){return L(e,t)})),u=Math.max.apply(Math,Object(R.a)(i));if(u===c)return"break";var o=i.map((function(e,t){return e===u?t:-1})).filter((function(e){return e>-1}));if(n&&255===u)return"break";i=i.filter((function(e,t){return o.includes(t)})),a=a.filter((function(e,t){return o.includes(t)}));var l=W.sub(W.mul(W.sum(a),1/o.length),r),s=a.map((function(e){return W.dist(e,l)}));return r=a[s.indexOf(Math.min.apply(Math,Object(R.a)(s)))],255===(c=u)?"break":void 0},u=0;u<20;u++){var o=i(u);if("break"===o)break}return r},A=function(e,t){var n,a=W.nbrs(t).map((function(t){return L(e,t)})).map((function(e){return 255===e?1:0}));return(n=a)[7]&&n[0]&&n[1]||n[1]&&n[2]&&n[3]||n[3]&&n[4]&&n[5]||n[5]&&n[6]&&n[7]||function(e){for(var t=0,n=0;n<8;n++)t+=e[n]^e[(n+1)%8];return t>4}(a)},T=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(255!==L(e,t))return[];if(A(e,t))return[t];var a=[],r=[],c={};for(r.push(t);r.length;){var i=r.pop();if(!c[i.toString()]){c[i.toString()]=!0,a.push(i);var u=W.nbrs(i).filter((function(t){return 255===L(e,t)})),o=u.filter((function(t){return A(e,t)}));o.length?n&&o.forEach((function(e){return a.push(e)})):u.forEach((function(e){return r.push(e)}))}}return a},I=function(e,t){if(255===L(e,t))return!1;var n=W.nbrs(t).map((function(t){return L(e,t)})).map((function(e){return 255===e?1:0})),a=n.reduce((function(e,t){return e+t}),0);if(a>=7)return!0;var r=0;if(2===a){for(var c=0;c<8;c++)r+=n[c]&&n[c]^n[(c+1)%8]&&n[c]^n[(c+2)%8];return 2===r}for(var i=0;i<8;i++)r+=n[i]^n[(i+1)%8]&&n[i]^n[(i+2)%8];return r>=3},U=function(e,t){var n=function(t){return e.filter((function(e){return 255===L(e,t)})).length>0};if(n(t))return[];var a=[],r=[],c={};for(r.push(t);r.length;){var i=r.pop();if(!c[i.toString()])if(c[i.toString()]=!0,a.push(i),W.closeNbrs(i).filter((function(e){return!n(e)})).filter((function(e){return!c[e.toString()]})).forEach((function(e){return r.push(e)})),a.length>1e3)break}return a},Y=function(e,t,n){t[0]>=0&&t[1]>=0&&t[0]<e.cols&&t[1]<e.rows&&e.ucharPtr(t[0],t[1]).set(n)},V=function(e){cv.threshold(e,e,254,255,cv.THRESH_BINARY);for(var t=2;t<6;t++){var n=cv.Mat.ones(t,t,cv.CV_8U),a=new cv.Mat;cv.dilate(e,a,n,new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),cv.addWeighted(e,.8,a,.2,0,e),n.delete(),a.delete()}},_=function(){l&&(l.delete(),i.delete(),u.delete(),o.delete())},D=function(){_(),l=i=u=o=void 0,a&&(a.delete(),r.delete(),c.delete())},G=[16,800],H=[16,800],z={showBg:!0,bgWeight:1,showEdge:!0,showEdgeValley:!1,edgeWeight:.4,showLabel:!0,labelColor:[255,255,0,255],labelWeight:.8},F=new j.a,q=new C.a(z),J=new j.a,P=new C.a({width:-1,height:-1,x:-1,y:-1}),K=new C.a(!1),Q=new j.a,X=new j.a,Z=new j.a,$=new j.a,ee={width:0,height:0},te={width:[0,0],height:[0,0]},ne=function(){var e=s.pop();e&&(J.next({roi:e.roi}),e.update.next(Object(v.a)({},e,{isUndo:!0})))},ae=function(e,t){return t<e[0]?e[0]:t>e[1]?e[1]:t},re=function(e){var t=ae(te.width,e.width),n=ae(te.height,e.height);return{width:t,height:n,x:ae([0,ee.width-t-1],e.x),y:ae([0,ee.height-n-1],e.y)}};F.pipe(Object(x.a)((function(){return K.value}))).subscribe((function(e){return q.next(Object(v.a)({},q.value,{},e))})),q.subscribe((function(){return $.next({})})),J.pipe(Object(x.a)((function(e){return!function(e){return e.isResize&&(e.roi.width<te.width[0]||e.roi.width>te.width[1]||e.roi.height<te.height[0]||e.roi.height>te.height[1])}(e)})),Object(y.a)((function(e){return Object(v.a)({},e,{roi:re(e.roi)})})),Object(M.a)((function(e,t){return!t.isInit&&JSON.stringify(e.roi)===JSON.stringify(t.roi)})),Object(S.a)("roi"),Object(B.a)((function(e){_(),l=new cv.Mat.zeros(e.height,e.width,a.type()),i=a.roi(e),u=r.roi(e),o=c.roi(e)}))).subscribe((function(e){return P.next(e)})),P.subscribe((function(){return X.next({})})),Q.pipe(Object(B.a)((function(){return K.next(!1)})),Object(B.a)((function(e){D(),a=cv.imread(e),r=new cv.Mat,cv.cvtColor(a,r,cv.COLOR_RGB2GRAY,0),cv.Canny(r,r,50,100,3,!1),c=new cv.Mat.zeros(r.rows,r.cols,r.type())}))).subscribe((function(e){ee={width:e.width,height:e.height},te={width:[16,Math.min(G[1],ee.width)],height:[16,Math.min(H[1],ee.height)]},J.next({isInit:!0,roi:{x:0,y:0,width:Math.min(400,e.width),height:Math.min(400,e.height)}}),V(u),$.next({dimBy:96}),s=[],K.next(!0)})),X.pipe(Object(x.a)((function(){return K.value}))).subscribe((function(e){var t;(null===(t=e.targets)||void 0===t?void 0:t.length)&&(e.targets.forEach((function(t){return Y(u,t,[e.isSet?255:0])})),e.isUndo||s.push({update:X,roi:P.value,targets:e.targets,isSet:!e.isSet})),V(u),$.next({})})),Z.pipe(Object(x.a)((function(){return K.value}))).subscribe((function(e){var t;(null===(t=e.targets)||void 0===t?void 0:t.length)&&(e.targets.forEach((function(t){return Y(o,t,[e.isSet?255:0])})),e.isUndo||s.push({update:Z,roi:P.value,targets:e.targets,isSet:!e.isSet})),function(){var e=new cv.Mat;cv.threshold(c,e,254,255,cv.THRESH_BINARY),cv.imshow("output",e)}(),$.next({})})),$.pipe(Object(x.a)((function(){return K.value})),Object(B.a)((function(){return function(e,t){if(e.setTo([0,0,0,0]),t.showBg&&cv.addWeighted(e,1,i,t.bgWeight,0,e),t.showEdge){var n=new cv.Mat.zeros(u.rows,u.cols,u.type());t.showEdgeValley?cv.add(u,n,n):cv.threshold(u,n,254,255,cv.THRESH_BINARY),cv.cvtColor(n,n,cv.COLOR_GRAY2RGBA),cv.addWeighted(e,1,n,t.edgeWeight,0,e),n.delete()}if(t.showLabel){var a=new cv.Mat;cv.threshold(o,a,254,255,cv.THRESH_BINARY);var r=new cv.Mat;cv.cvtColor(a,r,cv.COLOR_GRAY2RGBA);var c=new cv.Mat(r.rows,r.cols,r.type(),t.labelColor.map((function(e){return 255-e})));cv.addWeighted(e,1,r,t.labelWeight,0,e),cv.subtract(e,c,e,a),a.delete(),r.delete(),c.delete()}}(l,q.value)}))).subscribe((function(e){var t,n;(null===(t=e.targets)||void 0===t?void 0:t.length)&&e.targets.forEach((function(t){return Y(l,t,e.color)})),e.dimBy&&function(e,t){var n=new cv.Mat(e.rows,e.cols,e.type(),[0,0,0,t]);cv.subtract(e,n,e),n.delete()}(l,e.dimBy),n=l,cv.imshow("canvas",n)}));n(114);var ce={0:[1,2,3],1:[1,3],2:[2,3],3:[3],4:[3]},ie={0:z,1:Object(v.a)({},z,{bgWeight:1,edgeWeight:1}),2:Object(v.a)({},z,{bgWeight:.8,edgeWeight:.8}),3:Object(v.a)({},z,{bgWeight:.8,edgeWeight:.8}),4:Object(v.a)({},z,{bgWeight:.6}),5:Object(v.a)({},z,{showEdge:!1,labelWeight:.4})},ue={0:[0,0,0,0],1:[0,255,255,255],2:[255,0,255,255],3:[255,0,0,255]},oe=function(e,t){var n=e.getBoundingClientRect();return[(t.clientX-n.left)/n.width,(t.clientY-n.top)/n.height]},le=function(e,t){var n=t.map((function(t,n){return Math.floor(t*[e.width,e.height][n])}));return[n[1],n[0]]};function se(){var e=Object(h.useState)(!1),t=Object(g.a)(e,2),n=t[0],a=t[1],r=Object(h.useState)(0),c=Object(g.a)(r,2),i=c[0],l=c[1],s=Object(h.useState)(1),f=Object(g.a)(s,2),b=f[0],j=f[1],C=Object(h.useState)(!1),x=Object(g.a)(C,2),y=x[0],M=x[1],S=Object(h.useState)([-1,-1]),B=Object(g.a)(S,2),R=B[0],W=B[1],A=Object(h.useState)(!1),Y=Object(g.a)(A,2),V=Y[0],_=Y[1],G=Object(h.useState)(P.value),H=Object(g.a)(G,2),z=H[0],ee=H[1],te=Object(h.useState)(K.value),ae=Object(g.a)(te,2),re=ae[0],se=ae[1],he=Object(h.useState)(q.value),de=Object(g.a)(he,2),fe=de[0],be=de[1],ge=Object(h.useRef)(null),ve=Object(h.useRef)(null);Object(h.useEffect)((function(){window.addEventListener("beforeunload",D);var e=P.subscribe(ee),t=K.subscribe(se),n=q.subscribe(be);return function(){window.removeEventListener("beforeunload",D),e.unsubscribe(),t.unsubscribe(),n.unsubscribe()}}),[]);var me=Object(h.useCallback)((function(){var e,t=document.createElement("a");t.download="label.png",t.href=null===(e=ve.current)||void 0===e?void 0:e.toDataURL("image/png"),t.click()}),[]),pe=Object(h.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(V){if(!y||-1===R[0])return;J.next({roi:Object(v.a)({},z,{x:z.x+R[1]-e[1],y:z.y+R[0]-e[0]})})}else{var n;switch(b){case 0:n=[];break;case 3:n=[e];break;case 1:n=T(u,N(u,e));break;case 2:n=[N(u,e,!0)].filter((function(e){return L(u,e)}))}if(0===i||!y&&!t)$.next({targets:n,color:ue[b]});else{if(!n.length)return;switch(i){case 1:n=n.filter((function(e){return 255===L(u,e)})),X.next({isSet:!1,targets:n});break;case 2:X.next({isSet:!0,targets:n});break;case 3:for(var a=n.pop(),r=20,c=a[0]-r;c<a[0]+r;c++)for(var l=a[1]-r;l<a[1]+r;l++)n.push([c,l]);n=n.filter((function(e){return I(u,e)})),X.next({isSet:!0,targets:n});break;case 4:n=U([u,o],n[0]),Z.next({isSet:!0,targets:n})}if(!n.length)return}}}),[z,i,b,y,R,V]),we=Object(h.useCallback)((function(e,t){if(b!==e){for(;ce[t].indexOf(e)<0;)e=(e+1)%4;j(e)}i!==t&&(l(t),j(ce[t][0]),F.next(ie[t]))}),[b,i]),Ee=Object(h.useCallback)((function(e){Q.next(e.currentTarget)}),[]),Oe=Object(h.useCallback)((function(e){re&&(n||$.next({dimBy:64}))}),[re,n]),ke=Object(h.useCallback)((function(e){re&&(M(!1),W([-1,-1]),n||$.next({dimBy:96}))}),[re,n]),je=Object(h.useCallback)((function(e){if(re&&n){var t=le(z,oe(e.currentTarget,e));t.toString()!==R.toString()&&(pe(t),W(t))}}),[re,z,n,R,pe]),Ce=Object(h.useCallback)((function(e){if(re&&(W([-1,-1]),n&&(M(!0),0!==i))){var t=le(z,oe(e.currentTarget,e));pe(t,!0)}}),[re,z,n,i,pe]),xe=Object(h.useCallback)((function(e){re&&M(!1)}),[re]),ye=Object(h.useCallback)((function(e){if(re&&!V){W([-1,-1]);var t=b,n=i;switch(e.key){case"q":break;case"f":t=(b+1)%4;break;case"z":ne();break;case"s":me();break;case"w":n=1;break;case"e":n=2;break;case"r":n=3;break;case"d":n=4;break;default:n=0}we(t,n)}}),[re,V,i,b,we,me]),Me=Object(h.useCallback)((function(e){if(re)switch(e.key){case"q":_(!0)}}),[re]),Se=Object(h.useCallback)((function(e){if(re)switch(e.key){case"q":_(!1)}}),[re]),Be=Object(h.useCallback)((function(){re&&(a(!0),$.next({}))}),[re]),Re=Object(h.useCallback)((function(){re&&(a(!1),M(!1),W([-1,-1]),$.next({dimBy:96}))}),[re]),We=Object(h.useCallback)((function(e){if(re&&V){e.preventDefault();var t=oe(e.currentTarget,e),n=le(z,t),a=Object(v.a)({},z,{width:e.deltaY>0?Math.ceil(1.05*z.width):Math.floor(.95*z.width),height:e.deltaY>0?Math.ceil(1.05*z.height):Math.floor(.95*z.height)}),r=le(a,t);J.next({isResize:!0,roi:Object(v.a)({},a,{x:z.x+n[1]-r[1],y:z.y+n[0]-r[0]})})}}),[re,z,V]),Le=Object(h.useMemo)((function(){return d.a.createElement(m.a,{align:"middle"},d.a.createElement(p.a,{span:24},d.a.createElement("span",null,"Action: "),d.a.createElement(w.a.Group,{value:i,onChange:function(e){return we(b,e.target.value)},disabled:!re},d.a.createElement(w.a.Button,{value:0},"No Action"),d.a.createElement(w.a.Button,{value:1},"Wipe Edge (W)"),d.a.createElement(w.a.Button,{value:2},"Draw Edge (E)"),d.a.createElement(w.a.Button,{value:3},"Repair Edge (R)"),d.a.createElement(w.a.Button,{value:4},"Fill Label (D)"))))}),[re,i,b,we]),Ne=Object(h.useMemo)((function(){return d.a.createElement(m.a,{align:"middle"},d.a.createElement(p.a,{span:4},d.a.createElement("span",null,"Move Canvas: "),d.a.createElement(E.a,{checked:V,unCheckedChildren:"Q",checkedChildren:"Q"})),d.a.createElement(p.a,{span:10},d.a.createElement("span",null,"Cursor (F): "),d.a.createElement(w.a.Group,{value:b,onChange:function(e){return we(e.target.value,i)},disabled:!re},d.a.createElement(w.a.Button,{value:1,disabled:ce[i].indexOf(1)<0},"Fall to Edge"),d.a.createElement(w.a.Button,{value:2,disabled:ce[i].indexOf(2)<0},"Adhere to Edge"),d.a.createElement(w.a.Button,{value:3,disabled:ce[i].indexOf(3)<0},"Floating"))),d.a.createElement(p.a,{span:3},d.a.createElement(O.a,{className:"button",type:"danger",ghost:!0,onClick:ne,disabled:!re},"Undo (Z)")),d.a.createElement(p.a,{span:3},d.a.createElement(O.a,{className:"button",type:"primary",ghost:!0,onClick:me,disabled:!re},"Save Label (S)")))}),[re,i,b,me,V,we]),Ae=Object(h.useMemo)((function(){return d.a.createElement(m.a,{align:"middle"},d.a.createElement(p.a,{span:2,offset:4},d.a.createElement("span",null,"Appearance: ")),d.a.createElement(p.a,{span:3},d.a.createElement(E.a,{disabled:!re,checked:fe.showBg,unCheckedChildren:"Background",checkedChildren:"Background",onClick:function(){return F.next({showBg:!fe.showBg})}}),d.a.createElement(k.a,{disabled:!re,min:0,max:1,step:.1,value:fe.bgWeight,onChange:function(e){return F.next({bgWeight:e})}})),d.a.createElement(p.a,{span:3,offset:1},d.a.createElement(m.a,null,d.a.createElement(p.a,{span:12},d.a.createElement(E.a,{disabled:!re,checked:fe.showEdge,unCheckedChildren:"Edge",checkedChildren:"Edge",onClick:function(){return F.next({showEdge:!fe.showEdge})}})),d.a.createElement(p.a,{span:12},d.a.createElement(E.a,{disabled:!re,checked:fe.showEdgeValley&&fe.showEdge,unCheckedChildren:"Valley",checkedChildren:"Valley",onClick:function(){return F.next({showEdgeValley:!fe.showEdgeValley})}}))),d.a.createElement(k.a,{disabled:!re,min:0,max:1,step:.1,value:fe.edgeWeight,onChange:function(e){return F.next({edgeWeight:e})}})),d.a.createElement(p.a,{span:3,offset:1},d.a.createElement(E.a,{disabled:!re,checked:fe.showLabel,unCheckedChildren:"Label",checkedChildren:"Label",onClick:function(){return F.next({showLabel:!fe.showLabel})}}),d.a.createElement(k.a,{disabled:!re,min:0,max:1,step:.1,value:fe.labelWeight,onChange:function(e){return F.next({labelWeight:e})}})))}),[re,fe]);return d.a.createElement("div",{className:"App"},d.a.createElement("div",{className:"input"},d.a.createElement("img",{id:"imageSrc",alt:"Canvas Input",ref:ge,onLoad:Ee,style:{display:"none"}}),d.a.createElement("input",{type:"file",id:"fileInput",name:"file",onChange:function(e){ge.current.src=URL.createObjectURL(e.target.files[0])}})),Le,Ne,Ae,d.a.createElement("div",{className:"canvas"},d.a.createElement("canvas",{id:"canvas",className:V?"moving":"",onMouseEnter:Oe,onMouseLeave:ke,onMouseMove:je,onMouseDown:Ce,onMouseUp:xe,onKeyPress:ye,onFocus:Be,onBlur:Re,onWheel:We,onKeyDown:Me,onKeyUp:Se,tabIndex:1e3})),d.a.createElement("canvas",{id:"output",ref:ve}))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));b.a.render(d.a.createElement(d.a.StrictMode,null,d.a.createElement(se,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[107,1,2]]]);
//# sourceMappingURL=main.7b0aa0ae.chunk.js.map